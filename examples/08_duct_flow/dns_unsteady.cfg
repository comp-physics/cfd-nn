# 3D Square Duct DNS - Unsteady Turbulent Flow
# No turbulence model - direct numerical simulation
# Resolves turbulent fluctuations in a square duct
#
# Re_b ~ 5000 based on bulk velocity and hydraulic diameter
# This is a marginally turbulent regime where DNS is feasible

simulation_mode = unsteady

# --- Grid (3D) ---
# Moderate resolution for DNS
Nx = 64
Ny = 64
Nz = 64

# --- Domain ---
# Streamwise: periodic (4*pi for longer domain)
x_min = 0.0
x_max = 12.566370614359172   # 4*pi

# Cross-section: [-1, 1] x [-1, 1] square duct
y_min = -1.0
y_max = 1.0
z_min = -1.0
z_max = 1.0

# --- Grid stretching ---
# Cluster points near all four walls
stretch_y = true
stretch_beta = 1.5
stretch_z = true
stretch_beta_z = 1.5

# --- Physics ---
# Re_b = U_b * D_h / nu ~ 5000
# D_h = 4*A/P = 4*(4)/(8) = 2 for unit square
# With U_b ~ 1, D_h = 2: nu = 2/5000 = 0.0004
nu = 0.0004
dp_dx = -0.01    # Pressure gradient drives the flow

# --- Time stepping ---
# Run for many flow-through times
# Convective time: L_x / U ~ 4*pi / 1 ~ 12.5
# Run for ~50 convective times
dt = 0.001
adaptive_dt = true
CFL_max = 0.4
max_iter = 30000    # T_final ~ 150, about 12 flow-throughs
tol = 0.0           # No convergence check - unsteady

# --- Turbulence model ---
turb_model = none   # DNS - no model

# --- Numerical schemes ---
convective_scheme = central    # No numerical dissipation

# --- Poisson solver ---
poisson_tol = 1e-6
poisson_max_iter = 10
poisson_omega = 1.8

# --- Output ---
output_dir = output/
output_freq = 500
num_snapshots = 30      # VTK snapshots for visualization
verbose = true
postprocess = false
write_fields = true

perturbation_amplitude = 0.1
